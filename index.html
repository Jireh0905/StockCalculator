<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‹ ì†ìµ ê³„ì‚°ê¸°</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        .calculator-container {
            max-width: 600px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background: #eee;
            margin-right: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            font-weight: bold;
            transition: background 0.3s;
        }
        .tab-button.active {
            background: #fff;
            border-bottom: 2px solid #007bff;
            color: #007bff;
        }
        .tab-content {
            display: none;
            padding: 10px 0;
        }
        .tab-content.active {
            display: block;
        }

        /* í¼ ë° ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input[type="number"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .input-group span {
            margin-left: 5px;
            font-size: 0.9em;
            color: #666;
        }
        
        /* ì„¤ì • ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .settings-toggle {
            cursor: pointer;
            color: #007bff;
            margin-bottom: 10px;
            display: inline-block;
            font-size: 0.9em;
        }
        .settings-content {
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        /* ë²„íŠ¼ ë° ê²°ê³¼ ìŠ¤íƒ€ì¼ */
        button#calculate {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button#calculate:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #e9ecef;
            font-size: 1.1em;
        }
        .result p {
            margin: 5px 0;
        }
        .profit {
            color: green;
            font-weight: bold;
        }
        .loss {
            color: red;
            font-weight: bold;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 500px) {
            body {
                padding: 10px;
            }
            .calculator-container {
                padding: 15px;
            }
            .tab-button {
                flex-grow: 1;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>ğŸ“Š ì£¼ì‹ ì†ìµ ê³„ì‚°ê¸°</h1>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab('domestic')">ğŸ‡°ğŸ‡· êµ­ë‚´ ì£¼ì‹</button>
            <button class="tab-button" onclick="openTab('global')">ğŸŒ í•´ì™¸ ì£¼ì‹</button>
        </div>

        <div id="domestic" class="tab-content active">
            <p><strong>êµ­ë‚´ ì£¼ì‹</strong>ì€ **ê±°ë˜ì„¸**ì™€ **ì¦ê¶Œì‚¬ ìˆ˜ìˆ˜ë£Œ**ê°€ ì ìš©ë©ë‹ˆë‹¤.</p>
            <div class="input-form">
                <div class="input-group"><label for="buyPriceD">ë§¤ìˆ˜ ê°€ê²© (ì›)</label><input type="number" id="buyPriceD" placeholder="ì˜ˆ: 10000"></div>
                <div class="input-group"><label for="sellPriceD">ë§¤ë„ ê°€ê²© (ì›)</label><input type="number" id="sellPriceD" placeholder="ì˜ˆ: 11000"></div>
                <div class="input-group"><label for="quantityD">ìˆ˜ëŸ‰ (ì£¼)</label><input type="number" id="quantityD" placeholder="ì˜ˆ: 10"></div>
            </div>
            
            <div class="settings-toggle" onclick="toggleSettings('settingsD')">âš™ï¸ ìˆ˜ìˆ˜ë£Œ/ì„¸ê¸ˆ ì„¤ì • (í´ë¦­í•˜ì—¬ ìˆ˜ì •)</div>
            <div id="settingsD" class="settings-content" style="display:none;">
                <div class="input-group"><label for="commRateD">ì¦ê¶Œì‚¬ ìˆ˜ìˆ˜ë£Œìœ¨ (ë§¤ìˆ˜/ë§¤ë„ ì‹œ, %)</label><input type="number" id="commRateD" value="0.015" step="0.001"><span> (ê¸°ë³¸: 0.015%)</span></div>
                <div class="input-group"><label for="taxRateD">ê±°ë˜ì„¸ìœ¨ (ë§¤ë„ ì‹œ, %)</label><input type="number" id="taxRateD" value="0.20" step="0.01"><span> (ê¸°ë³¸: 0.20%)</span></div>
            </div>

            <button id="calculate" onclick="calculateProfit('domestic')">ì†ìµ ê³„ì‚°í•˜ê¸°</button>
        </div>

        <div id="global" class="tab-content">
            <p><strong>í•´ì™¸ ì£¼ì‹</strong>ì€ **ì–‘ë„ì†Œë“ì„¸**ì™€ **ì¦ê¶Œì‚¬ ìˆ˜ìˆ˜ë£Œ**ê°€ ì ìš©ë©ë‹ˆë‹¤.</p>
            <div class="input-form">
                <div class="input-group"><label for="buyPriceG">ë§¤ìˆ˜ ê°€ê²© (ë‹¬ëŸ¬, USD)</label><input type="number" id="buyPriceG" placeholder="ì˜ˆ: 100"></div>
                <div class="input-group"><label for="sellPriceG">ë§¤ë„ ê°€ê²© (ë‹¬ëŸ¬, USD)</label><input type="number" id="sellPriceG" placeholder="ì˜ˆ: 110"></div>
                <div class="input-group"><label for="quantityG">ìˆ˜ëŸ‰ (ì£¼)</label><input type="number" id="quantityG" placeholder="ì˜ˆ: 10"></div>
                <div class="input-group"><label for="exchangeRateG">ì ìš© í™˜ìœ¨ (ì›/USD)</label><input type="number" id="exchangeRateG" placeholder="ì˜ˆ: 1300" value="1300"></div>
            </div>

            <div class="settings-toggle" onclick="toggleSettings('settingsG')">âš™ï¸ ìˆ˜ìˆ˜ë£Œ/ì„¸ê¸ˆ ì„¤ì • (í´ë¦­í•˜ì—¬ ìˆ˜ì •)</div>
            <div id="settingsG" class="settings-content" style="display:none;">
                <div class="input-group"><label for="commRateG">ì¦ê¶Œì‚¬ ìˆ˜ìˆ˜ë£Œìœ¨ (ë§¤ìˆ˜/ë§¤ë„ ì‹œ, %)</label><input type="number" id="commRateG" value="0.10" step="0.01"><span> (ê¸°ë³¸: 0.10%)</span></div>
                <div class="input-group"><label for="taxRateG">ì–‘ë„ì†Œë“ì„¸ìœ¨ (ì´ìµ ë°œìƒ ì‹œ, %)</label><input type="number" id="taxRateG" value="22.0" step="0.1"><span> (ê¸°ë³¸: 22.0% - ì§€ë°©ì†Œë“ì„¸ í¬í•¨)</span></div>
                <div class="input-group"><label for="taxBaseG">ì–‘ë„ì†Œë“ ê¸°ë³¸ê³µì œ (ì›)</label><input type="number" id="taxBaseG" value="2500000" step="100000"><span> (ê¸°ë³¸: 250ë§Œ ì›)</span></div>
            </div>

            <button id="calculate" onclick="calculateProfit('global')">ì†ìµ ê³„ì‚°í•˜ê¸°</button>
        </div>
        
        <div id="result" class="result">
            <p>ì—¬ê¸°ì— ê³„ì‚° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            const resultDiv = document.getElementById('result');

            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(button => button.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-button[onclick="openTab('${tabName}')"]`).classList.add('active');
            
            // íƒ­ ì „í™˜ ì‹œ ê²°ê³¼ ì´ˆê¸°í™”
            resultDiv.innerHTML = '<p>ì—¬ê¸°ì— ê³„ì‚° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
        }

        // ìˆ˜ìˆ˜ë£Œ/ì„¸ê¸ˆ ì„¤ì • ì˜ì—­ í† ê¸€ ê¸°ëŠ¥
        function toggleSettings(settingsId) {
            const settingsDiv = document.getElementById(settingsId);
            settingsDiv.style.display = settingsDiv.style.display === 'none' ? 'block' : 'none';
        }

        // ìˆ«ì í¬ë§· í•¨ìˆ˜ (ì„¸ ìë¦¬ë§ˆë‹¤ ì½¤ë§ˆ ì¶”ê°€)
        function formatNumber(num) {
            return num.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // ì†ìµ ê³„ì‚° ë©”ì¸ í•¨ìˆ˜
        function calculateProfit(type) {
            const resultDiv = document.getElementById('result');
            let buyPrice, sellPrice, quantity;
            let commRate, taxRate;
            let currencyUnit, taxName;
            let taxBase;

            // 1. ì…ë ¥ ê°’ ê°€ì ¸ì˜¤ê¸°
            if (type === 'domestic') {
                buyPrice = parseFloat(document.getElementById('buyPriceD').value);
                sellPrice = parseFloat(document.getElementById('sellPriceD').value);
                quantity = parseInt(document.getElementById('quantityD').value);
                commRate = parseFloat(document.getElementById('commRateD').value) / 100; // % -> ì†Œìˆ˜
                taxRate = parseFloat(document.getElementById('taxRateD').value) / 100; // % -> ì†Œìˆ˜
                currencyUnit = 'ì›';
                taxName = 'ê±°ë˜ì„¸';
            } else if (type === 'global') {
                buyPrice = parseFloat(document.getElementById('buyPriceG').value);
                sellPrice = parseFloat(document.getElementById('sellPriceG').value);
                quantity = parseInt(document.getElementById('quantityG').value);
                const exchangeRate = parseFloat(document.getElementById('exchangeRateG').value);
                commRate = parseFloat(document.getElementById('commRateG').value) / 100; // % -> ì†Œìˆ˜
                taxRate = parseFloat(document.getElementById('taxRateG').value) / 100; // % -> ì†Œìˆ˜ (ì–‘ë„ì†Œë“ì„¸)
                taxBase = parseInt(document.getElementById('taxBaseG').value); // ê¸°ë³¸ê³µì œ
                currencyUnit = 'ì›';
                taxName = 'ì–‘ë„ì†Œë“ì„¸';

                // ë‹¬ëŸ¬ ê¸ˆì•¡ì„ ì›í™”ë¡œ í™˜ì‚° (ê³„ì‚°ì„ ì›í™” ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰)
                if (exchangeRate) {
                    buyPrice *= exchangeRate;
                    sellPrice *= exchangeRate;
                } else {
                    alert('í™˜ìœ¨ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                    return;
                }
            }

            // 2. ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬
            if (isNaN(buyPrice) || isNaN(sellPrice) || isNaN(quantity) || quantity <= 0) {
                resultDiv.innerHTML = '<p style="color:red;">âš ï¸ **ë§¤ìˆ˜/ë§¤ë„ ê°€ê²© ë° ìˆ˜ëŸ‰**ì„ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>';
                return;
            }

            // 3. ê³„ì‚° ë¡œì§
            const totalBuy = buyPrice * quantity; // ì´ ë§¤ìˆ˜ ê¸ˆì•¡
            const buyComm = totalBuy * commRate; // ë§¤ìˆ˜ ìˆ˜ìˆ˜ë£Œ
            const totalSell = sellPrice * quantity; // ì´ ë§¤ë„ ê¸ˆì•¡
            const sellComm = totalSell * commRate; // ë§¤ë„ ìˆ˜ìˆ˜ë£Œ

            let profitLossBeforeTax = totalSell - totalBuy - buyComm - sellComm; // ì„¸ì „ ì†ìµ

            let tax = 0;
            let netProfitLoss = 0; // ìµœì¢… ì†ìµ
            let nTotalRate = 0; // ì´ ìˆ˜ìµë¥ 

            if (type === 'domestic') {
                // êµ­ë‚´ ì£¼ì‹: ê±°ë˜ì„¸ (ë§¤ë„ ê¸ˆì•¡ ê¸°ì¤€)
                tax = totalSell * taxRate;
                netProfitLoss = profitLossBeforeTax - tax;
            } else if (type === 'global') {
                // í•´ì™¸ ì£¼ì‹: ì–‘ë„ì†Œë“ì„¸ (ì´ìµ ë°œìƒ ì‹œ)
                const capitalGain = totalSell - totalBuy; // ì–‘ë„ì°¨ìµ (ë§¤ë§¤ ì°¨ìµ)
                
                if (capitalGain > 0) {
                    // ê¸°ë³¸ ê³µì œ ì ìš© í›„ ê³¼ì„¸ í‘œì¤€ ê³„ì‚°
                    let taxableIncome = capitalGain - taxBase;
                    if (taxableIncome < 0) taxableIncome = 0; // ê³¼ì„¸ í‘œì¤€ì€ 0ë³´ë‹¤ ì‘ì„ ìˆ˜ ì—†ìŒ

                    tax = taxableIncome * taxRate; // ì–‘ë„ì†Œë“ì„¸
                    // ì–‘ë„ì†Œë“ì„¸ëŠ” ì–‘ë„ì°¨ìµì´ ë°œìƒí–ˆì„ ë•Œë§Œ ë¶€ê³¼ë¨
                }
                netProfitLoss = profitLossBeforeTax - tax;
            }

            nTotalRate = (netProfitLoss / totalBuy * 100).toFixed(3);

            // 4. ê²°ê³¼ ì¶œë ¥
            const profitLossClass = netProfitLoss >= 0 ? 'profit' : 'loss';
            const totalTax = type === 'domestic' ? tax : tax; // êµ­ë‚´:ê±°ë˜ì„¸, í•´ì™¸:ì–‘ë„ì„¸
            
            let resultHTML = `
                <h2>ğŸ’° ê³„ì‚° ê²°ê³¼</h2>
                <p>ì´ ë§¤ìˆ˜ ê¸ˆì•¡ (ìˆ˜ìˆ˜ë£Œ í¬í•¨): **${formatNumber(totalBuy + buyComm)} ${currencyUnit}**</p>
                <p>ì´ ë§¤ë„ ê¸ˆì•¡ (ìˆ˜ìˆ˜ë£Œ ì°¨ê° ì „): **${formatNumber(totalSell)} ${currencyUnit}**</p>
                <hr>
                <p>ë§¤ìˆ˜ ìˆ˜ìˆ˜ë£Œ (${(commRate * 100).toFixed(3)}%): ${formatNumber(buyComm)} ${currencyUnit}</p>
                <p>ë§¤ë„ ìˆ˜ìˆ˜ë£Œ (${(commRate * 100).toFixed(3)}%): ${formatNumber(sellComm)} ${currencyUnit}</p>
                <p>${taxName} (${(taxRate * 100).toFixed(2)}%): ${formatNumber(totalTax)} ${currencyUnit}</p>
                <hr>
                <p>ì„¸ì „ ì†ìµ: ${formatNumber(profitLossBeforeTax)} ${currencyUnit}</p>
                <p><strong>ìµœì¢… ì†ìµ (ì„¸í›„): <span class="${profitLossClass}">${formatNumber(netProfitLoss)} ${currencyUnit}</span></strong></p>
                <p><strong>ìˆ˜ìµë¥ : <span class="${profitLossClass}">${nTotalRate}${'%'}</span></strong></p>
            `;
            
            if (type === 'global') {
                resultHTML += `<p style="font-size:0.9em; margin-top:10px;">(ì°¸ê³ : í•´ì™¸ ì£¼ì‹ ì–‘ë„ì†Œë“ì„¸ëŠ” ê¸°ë³¸ ê³µì œ ${formatNumber(taxBase)}ì› ì ìš© í›„ ê³„ì‚°ë©ë‹ˆë‹¤.)</p>`;
            }

            resultDiv.innerHTML = resultHTML;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ êµ­ë‚´ ì£¼ì‹ íƒ­ì´ ë³´ì´ë„ë¡ ì„¤ì •
        document.addEventListener('DOMContentLoaded', () => {
            openTab('domestic');
        });
    </script>
</body>
</html>