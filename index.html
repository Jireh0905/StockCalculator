<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‹ ì†ìµ ê³„ì‚°ê¸°</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        .calculator-container {
            max-width: 600px;
            margin: 30px auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative; /*ì•„ì´ì½˜ì˜ ê¸°ì¤€ì ì„ ìœ„í•´ ì¶”ê°€*/
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
        }
        .tab-button {
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            background: #38383839;
            margin-right: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            font-size: 1.2em;
            font-weight: bold;
            transition: background 0.3s;
        }
        .tab-button.active {
            background: #fff;
            border-bottom: 3px solid #007bff;
            
            color: #007bff;
        }
        .tab-content {
            display: none;
            padding: 10px 0;
        }
        .tab-content.active {
            display: block;
        }
        .tab-content.active p:first-child {
            margin-bottom: 5px;
        }

        /* í¼ ë° ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input[type="number"],
        .input-group input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;

            font-size: 1em;
            color: #333;
        }
        .input-group span {
            margin-left: 5px;
            font-size: 0.9em;
            color: #666;
        }
        
        /* ì„¤ì • ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .settings-toggle {
            cursor: pointer;
            color: #007bff;
            margin-bottom: 15px;
            display: inline-block;
            font-size: 1.1em;
        }
        .settings-content {
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        /* ë²„íŠ¼ ë° ê²°ê³¼ ìŠ¤íƒ€ì¼ */
        button#calculate {
            width: 100%;
            margin-top: 30px;
            padding: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button#calculate:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #e9ecef;
            font-size: 1.1em;
        }
        .result p {
            margin: 5px 0;
        }
        .profit {
            color: green;
            font-weight: bold;
        }
        .loss {
            color: red;
            font-weight: bold;
        }
        .result h2 {
            margin-top: 0px;
            margin-bottom: 12px;
        }

        /* History ë©”ë‰´ ì»¨í…Œì´ë„ˆ ë° ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        #history-menu-container {
            position: absolute; /* fixedë¥¼ absoluteë¡œ ë³€ê²½í•˜ì—¬ .calculator-containerë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ìŠµë‹ˆë‹¤ */
            top: 0;       /* .calculator-containerì˜ ìƒë‹¨ì—ì„œ 0px (íŒ¨ë”© ê³ ë ¤) */
            right: 0;     /* .calculator-containerì˜ ìš°ì¸¡ì—ì„œ 0px (íŒ¨ë”© ê³ ë ¤) */
            z-index: 1000;   /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œë˜ë„ë¡ ê°€ì¥ ë†’ì€ Z-index ì„¤ì • */
        }
        #history-icon {
            /* ê³„ì‚°ê¸° ì»¨í…Œì´ë„ˆì˜ ìƒë‹¨ íŒ¨ë”©(20px)ê³¼ ìš°ì¸¡ íŒ¨ë”©(20px)ì„ ê³ ë ¤í•˜ì—¬ ì•„ì´ì½˜ ìœ„ì¹˜ë¥¼ ë§ì¶¥ë‹ˆë‹¤. */
            position: absolute;
            top: 20px;
            right: 20px;
            
            padding: 10px 15px;
            background-color: #787879;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
        }
        #history-icon:hover {
            background-color: #a2a2a4;
        }
        /* íŒì—… íŒ¨ë„ ìŠ¤íƒ€ì¼ (ë©”ë‰´ì²˜ëŸ¼ ë³´ì´ë„ë¡) */
        #history-panel {
            position: absolute; /* ì•„ì´ì½˜ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ì§€ì • */
            top: 55px;          /* ì•„ì´ì½˜ ì•„ë˜ì— í‘œì‹œë˜ë„ë¡ ì¡°ì • */
            right: 0;           /* ì•„ì´ì½˜ê³¼ ìš°ì¸¡ ì •ë ¬ */
            width: 300px;       /* ë©”ë‰´ ë„ˆë¹„ ì§€ì • */
            max-height: 400px;  /* ìµœëŒ€ ë†’ì´ ì§€ì • */
            overflow-y: auto;   /* ë‚´ìš©ì´ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ë°” ìƒì„± */
            
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            
            /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¸°ê¸° */
            display: none; 
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(-10px); /* ì•½ê°„ ìœ„ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” íš¨ê³¼ */
        }
        /* íŒ¨ë„ì´ í™œì„±í™”ë  ë•Œ (JavaScriptì—ì„œ í´ë˜ìŠ¤ í† ê¸€) */
        #history-panel.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* ê¸°íƒ€ ë‚´ë¶€ ëª©ë¡ ìŠ¤íƒ€ì¼ì€ ê¸°ì¡´ ê²ƒì„ ìœ ì§€ */
        #history-panel h3 {
            margin-top: 0;
            font-size: 1.1em;
        }
        #history-list {
            list-style: none;
            padding: 0;
        }
        #history-list li {
            padding: 1px;
            margin-bottom: 5px;
            border-bottom: 1px dashed #e0e0e0;
            cursor: pointer; /* í´ë¦­ ê°€ëŠ¥í•˜ë‹¤ëŠ” í‘œì‹œ */
            transition: background-color 0.2s;
            font-size: 0.75em;
        }
        #history-list li:hover {
            background-color: #e0f7fa; /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ */
        }
        #history-clear-button {
            margin-top: 10px; padding: 5px 10px; cursor: pointer; font-size: 0.9em;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .calculator-container {
                padding: 10px;
                font-size: 0.6em;
            }
            .tab-button {
                text-align: center;
                padding: 8px 8px;
                font-size: 1.1em;
            }

            .input-group {
                margin-bottom: 8px;
                font-size: 0.6em;
            }
            .input-group span {
				margin-left: 10px;
				font-size: 0.6em;
				color: #666;
			}
            
            .settings-toggle {
                margin-bottom: 8px;
                font-size: 1.0em;
            }

            button#calculate {
                margin-top: 15px;
                padding: 10px;
                border-radius: 4px;
                font-size: 1.4em;
            }

            /* ëª¨ë°”ì¼ í™˜ê²½ì€ ì•„ì´ì½˜ ê·¸ëŒ€ë¡œ ìœ ì§€ */
            #history-icon {
                top: 15px; /* ëª¨ë°”ì¼ ì»¨í…Œì´ë„ˆ íŒ¨ë”©(15px)ì— ë§ì¶° ì¡°ì • */
                right: 15px;
            }
            /* ëª¨ë°”ì¼ì—ì„œëŠ” íŒ¨ë„ ë„ˆë¹„ë¥¼ í™”ë©´ì— ë§ê²Œ ì¡°ì • */
            #history-panel {
                width: 50vw; /* í™”ë©´ ë„ˆë¹„ì˜ 50% */
                right: 0vw;  /* ìš°ì¸¡ì—ì„œ 0% ë–¨ì–´ì§€ê²Œ í•˜ì—¬ ì¤‘ì•™ì— ê°€ê¹ê²Œ ë°°ì¹˜ */
                top: 45px;
                max-height: 200px;  /* ìµœëŒ€ ë†’ì´ ì§€ì • */
            }
            #history-list li {
                font-size: 7.5px;/*[Jireh] emìœ¼ë¡œëŠ” ì™œì¸ì§€ ëª¨ë¥´ê²Œ ë„ˆë¬´ ì‘ì€ ë‹¨ìœ„ëŠ” ë°˜ì˜ì´ ì•ˆ ë˜ëŠ” ë“¯í•´ì„œ í”½ì…€ë¡œ ë‹¨ìœ„ ë³€ê²½. 0.4em;*/
            }
            #history-clear-button {
                margin-top: 10px; padding: 2px 5px; cursor: pointer; font-size: 0.5em;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>ğŸ“Š ì£¼ì‹ ì†ìµ ê³„ì‚°ê¸°</h1>

        <div id="history-menu-container">
            <button id="history-icon" onclick="toggleHistoryPanel()">â‰£Jireh</button>

            <div id="history-panel" class="hidden">
                <h3>ğŸ“Š ê³„ì‚° ê¸°ë¡</h3>
                <ul id="history-list">
                    </ul>
                <button id="history-clear-button" onclick="clearHistory()">ê¸°ë¡ ì§€ìš°ê¸°</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab('domestic')">ğŸ‡°ğŸ‡· êµ­ë‚´ ì£¼ì‹</button>
            <button class="tab-button" onclick="openTab('global')">ğŸŒ í•´ì™¸ ì£¼ì‹</button>
        </div>

        <div id="domestic" class="tab-content active">
            <p><strong>êµ­ë‚´ ì£¼ì‹</strong>ì€ ê±°ë˜ì„¸ì™€ ì¦ê¶Œì‚¬ ìˆ˜ìˆ˜ë£Œê°€ ì ìš©ë©ë‹ˆë‹¤.</p>

            <div class="settings-toggle" onclick="toggleSettings('settingsD')">âš™ï¸ ìˆ˜ìˆ˜ë£Œ/ì„¸ê¸ˆ ì„¤ì •</div>
            <div id="settingsD" class="settings-content" style="display:none;">
                <div class="input-group"><label for="commRateD">ì¦ê¶Œì‚¬ ìˆ˜ìˆ˜ë£Œìœ¨ (ë§¤ìˆ˜/ë§¤ë„ ì‹œ, %)</label><input type="number" id="commRateD" value="0.015" step="0.001"><span> (ê¸°ë³¸: 0.015%)</span></div>
                <div class="input-group"><label for="taxRateD">ê±°ë˜ì„¸ìœ¨ (ë§¤ë„ ì‹œ, %)</label><input type="number" id="taxRateD" value="0.20" step="0.01"><span> (ê¸°ë³¸: 0.20%)</span></div>
            </div>

            <div class="input-form">
                <div class="input-group"><label for="buyPriceD">ë§¤ìˆ˜ ê°€ê²© (ì›)</label><input type="text" id="buyPriceD" placeholder="ì˜ˆ: 10,000" oninput="autoFormat(this)"></div>
                <div class="input-group"><label for="sellPriceD">ë§¤ë„ ê°€ê²© (ì›)</label><input type="text" id="sellPriceD" placeholder="ì˜ˆ: 11,000" oninput="autoFormat(this)"></div>
                <div class="input-group"><label for="quantityD">ìˆ˜ëŸ‰ (ì£¼)</label><input type="text" id="quantityD" placeholder="ì˜ˆ: 10" oninput="autoFormat(this)"></div>
            </div>

            <button id="calculate" onclick="calculateProfit('domestic')">ì†ìµ ê³„ì‚°í•˜ê¸°</button>
        </div>

        <div id="global" class="tab-content">
            <p><strong>í•´ì™¸ ì£¼ì‹</strong>ì€ ì–‘ë„ì†Œë“ì„¸ì™€ ì¦ê¶Œì‚¬ ìˆ˜ìˆ˜ë£Œê°€ ì ìš©ë©ë‹ˆë‹¤.</p>

            <div class="settings-toggle" onclick="toggleSettings('settingsG')">âš™ï¸ ìˆ˜ìˆ˜ë£Œ/ì„¸ê¸ˆ/í™˜ìœ¨ ì„¤ì •</div>
            <div id="settingsG" class="settings-content" style="display:none;">
                <div class="input-group"><label for="commRateG">ì¦ê¶Œì‚¬ ìˆ˜ìˆ˜ë£Œìœ¨ (ë§¤ìˆ˜/ë§¤ë„ ì‹œ, %)</label><input type="number" id="commRateG" value="0.10" step="0.01"><span> (ê¸°ë³¸: 0.10%)</span></div>
                <div class="input-group"><label for="taxRateG">ì–‘ë„ì†Œë“ì„¸ìœ¨ (ì´ìµ ë°œìƒ ì‹œ, %)</label><input type="number" id="taxRateG" value="22.0" step="0.1"><span> (ê¸°ë³¸: 22.0% - ì§€ë°©ì†Œë“ì„¸ í¬í•¨)</span></div>
                <div class="input-group"><label for="taxBaseG">ì–‘ë„ì†Œë“ì„¸ ê¸°ë³¸ ê³µì œ (ì›)</label><input type="text" id="taxBaseG" value="2,500,000" step="100,000,000" oninput="autoFormat(this)"><span> (ê¸°ë³¸: 250ë§Œ ì›)</span></div>
                <div class="input-group"><label for="exchangeRateG">ì ìš© í™˜ìœ¨ (ì›/USD)</label><input type="text" id="exchangeRateG" placeholder="ì˜ˆ: 1,300" value="1,300" oninput="autoFormat(this)"></div>
            </div>

            <div class="input-form">
                <div class="input-group"><label for="buyPriceG">ë§¤ìˆ˜ ê°€ê²© (ë‹¬ëŸ¬, USD)</label><input type="text" id="buyPriceG" placeholder="ì˜ˆ: 100" oninput="autoFormat(this)"></div>
                <div class="input-group"><label for="sellPriceG">ë§¤ë„ ê°€ê²© (ë‹¬ëŸ¬, USD)</label><input type="text" id="sellPriceG" placeholder="ì˜ˆ: 110" oninput="autoFormat(this)"></div>
                <div class="input-group"><label for="quantityG">ìˆ˜ëŸ‰ (ì£¼)</label><input type="text" id="quantityG" placeholder="ì˜ˆ: 10" oninput="autoFormat(this)"></div>
            </div>

            <button id="calculate" onclick="calculateProfit('global')">ì†ìµ ê³„ì‚°í•˜ê¸°</button>
        </div>

        <div id="result" class="result">
            <p>ì—¬ê¸°ì— ê³„ì‚° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>
        
        <div class="result-container">
            <div id="result">
                </div>
        </div>
        
    </div>

    <script>
        // History íŒ¨ë„ í† ê¸€ ê¸°ëŠ¥
        function toggleHistoryPanel() {
            const panel = document.getElementById('history-panel');
            
            // í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•©ë‹ˆë‹¤.
            if (panel.classList.contains('visible')) {
                panel.classList.remove('visible');
            } else {
                panel.classList.add('visible');
                // íŒ¨ë„ì´ ì—´ë¦´ ë•Œë§ˆë‹¤ ìµœì‹  ê¸°ë¡ì„ ë Œë”ë§í•˜ë„ë¡ ê°•ì œ í˜¸ì¶œ (ì„ íƒ ì‚¬í•­)
                renderHistory(); 
            }
        }

        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            const resultDiv = document.getElementById('result');

            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(button => button.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-button[onclick="openTab('${tabName}')"]`).classList.add('active');
            
            // íƒ­ ì „í™˜ ì‹œ ê²°ê³¼ ì´ˆê¸°í™”
            resultDiv.innerHTML = '<p>ì—¬ê¸°ì— ê³„ì‚° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
        }

        // ì…ë ¥ í•„ë“œì— ì‰¼í‘œë¥¼ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ê³ , ì‰¼í‘œ ì—†ëŠ” ìˆ«ì ê°’ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        function autoFormat(input) {
            // 1. ìˆ«ì(0-9)ì™€ ì†Œìˆ˜ì (.)ì„ ì œì™¸í•œ ëª¨ë“  ë¬¸ìë¥¼ ì œê±°í•˜ì—¬ ìˆœìˆ˜í•œ ìˆ«ì ë¬¸ìì—´ì„ ì–»ìŠµë‹ˆë‹¤.
            let cleanValue = input.value.replace(/[^\d.]/g, '');

            // 2. ì†Œìˆ˜ì  ì²˜ë¦¬: ì†Œìˆ˜ì ì´ ë‘ ê°œ ì´ìƒ ì…ë ¥ëœ ê²½ìš° ì²« ë²ˆì§¸ ì†Œìˆ˜ì ë§Œ ë‚¨ê¹ë‹ˆë‹¤.
            let decimalIndex = cleanValue.indexOf('.');
            if (decimalIndex !== -1) {
                // ì •ìˆ˜ë¶€ì™€ ì†Œìˆ˜ë¶€ ë¶„ë¦¬
                let integerPart = cleanValue.substring(0, decimalIndex);
                // ì²« ë²ˆì§¸ ì†Œìˆ˜ì  ì´í›„ì— ìˆëŠ” ë‹¤ë¥¸ ì†Œìˆ˜ì ë“¤ì€ ì œê±°
                let decimalPart = cleanValue.substring(decimalIndex + 1).replace(/\./g, '');
                
                // ë‹¤ì‹œ í•©ì¹˜ê¸°
                cleanValue = integerPart + '.' + decimalPart;
            }
            
            // 3. ì‰¼í‘œë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ ì •ìˆ˜ë¶€ì™€ ì†Œìˆ˜ë¶€ë¥¼ ìµœì¢…ì ìœ¼ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
            let parts = cleanValue.split('.');
            let integerPart = parts[0];
            let decimalPart = parts.length > 1 ? '.' + parts[1] : '';

            // 4. ì •ìˆ˜ë¶€ì— ì„¸ ìë¦¬ë§ˆë‹¤ ì‰¼í‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
            // \B: ë‹¨ì–´ ê²½ê³„ê°€ ì•„ë‹Œ ìœ„ì¹˜ (ìˆ«ì ì‚¬ì´)
            // (?=(\d{3})+(?!\d)): ë’¤ì— 3ìë¦¬ ìˆ«ìê°€ ë°˜ë³µë˜ê³  ë” ì´ìƒ ìˆ«ìê°€ ì•„ë‹Œ ê²ƒ(ì¢…ë£Œ)ì´ ì•„ë‹Œ íŒ¨í„´
            integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            // 5. ì‰¼í‘œê°€ ì ìš©ëœ ìµœì¢… ê°’ì„ ì…ë ¥ í•„ë“œì— ë‹¤ì‹œ ë„£ì–´ì¤ë‹ˆë‹¤.
            input.value = integerPart + decimalPart;
        }

        // ìˆ˜ìˆ˜ë£Œ/ì„¸ê¸ˆ ì„¤ì • ì˜ì—­ í† ê¸€ ê¸°ëŠ¥
        function toggleSettings(settingsId) {
            const settingsDiv = document.getElementById(settingsId);
            settingsDiv.style.display = settingsDiv.style.display === 'none' ? 'block' : 'none';
        }

        // ìˆ«ì í¬ë§· í•¨ìˆ˜ (ì„¸ ìë¦¬ë§ˆë‹¤ ì½¤ë§ˆ ì¶”ê°€)
        function formatNumber(num) {
            return num.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // í˜ì´ì§€ê°€ ë‹«í ë•Œê¹Œì§€ ê³„ì‚° ê¸°ë¡ì„ ì €ì¥í•  ë°°ì—´
        let calculationHistory = [];

        /**
         * ê³„ì‚° ê²°ê³¼ë¥¼ calculationHistory ë°°ì—´ì— ì €ì¥í•˜ê³  í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
         * @param {string} type - 'domestic' ë˜ëŠ” 'global'
         * @param {object} data - ë§¤ìˆ˜/ë§¤ë„ ê°€ê²©, ìˆ˜ëŸ‰, í™˜ìœ¨ ë“± ì…ë ¥ëœ ë°ì´í„°
         * @param {string} resultText - ê³„ì‚° ê²°ê³¼ ìš”ì•½ í…ìŠ¤íŠ¸
         */
        function saveHistory(type, data, resultText) {
            var timeOption = { hour: "numeric", minute: "numeric", second: "numeric", hour12: false };
            const historyItem = {
                type: type,
                data: data,
                summary: resultText.substring(0, 50), // + '...' ìš”ì•½ í…ìŠ¤íŠ¸
                timestamp: new Date().toLocaleTimeString('en-US', timeOption)
            };

            // ë°°ì—´ì— ì¶”ê°€ (ê°€ì¥ ìµœê·¼ í•­ëª©ì´ ìœ„ë¡œ ì˜¤ë„ë¡ prepend)
            calculationHistory.unshift(historyItem);
            
            /*
            // ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ì €ì¥ (ì„ íƒ ì‚¬í•­)
            if (calculationHistory.length > 10) {
                calculationHistory.pop();
            }
            */

            renderHistory(); // í™”ë©´ ì—…ë°ì´íŠ¸
        }

        /**
         * ì €ì¥ëœ ê³„ì‚° ê¸°ë¡ì„ HTML ëª©ë¡ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function renderHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = ''; // ëª©ë¡ ì´ˆê¸°í™”

            calculationHistory.forEach((item, index) => {
                const listItem = document.createElement('li');
                
                // í‘œì‹œí•  í…ìŠ¤íŠ¸: [ì‹œê°„] [êµ­ë‚´/í•´ì™¸] ìš”ì•½
                const typeText = item.type === 'domestic' ? 'ğŸ‡°ğŸ‡·êµ­ë‚´' : 'ğŸŒí•´ì™¸';
                listItem.innerHTML = `[${item.timestamp}] ${typeText} | ${item.summary}`;
                
                // í´ë¦­ ì‹œ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ ì—°ê²°
                listItem.onclick = () => loadHistory(index);
                
                historyList.appendChild(listItem);
            });
        }

        /**
         * íŠ¹ì • ê¸°ë¡ í•­ëª©ì„ ì…ë ¥ í•„ë“œì— ë‹¤ì‹œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
         * @param {number} index - calculationHistory ë°°ì—´ì˜ ì¸ë±ìŠ¤
         */
        function loadHistory(index) {
            const item = calculationHistory[index];
            if (!item) return;

            // 1. íƒ­ ì „í™˜
            const targetTabId = item.type;
            openTab(targetTabId);
            
            // 2. ì…ë ¥ í•„ë“œì— ë°ì´í„° ì±„ìš°ê¸°
            const data = item.data;
            
            // ì‰¼í‘œ í¬ë§·ì„ ì ìš©í•˜ì—¬ ê°’ ì±„ìš°ê¸°
            // autoFormat í•¨ìˆ˜ê°€ ì´ë¯¸ ì •ì˜ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ì´ë¥¼ ì´ìš©í•´ ê°’ì„ ì±„ì›ë‹ˆë‹¤.
            const fields = [
                // êµ­ë‚´
                { id: 'buyPriceD', value: data.buyPriceD },
                { id: 'sellPriceD', value: data.sellPriceD },
                { id: 'quantityD', value: data.quantityD },
                // êµ­ë‚´ ì£¼ì‹ ì„¤ì • í•„ë“œ(ìˆ˜ìˆ˜ë£Œ, ê±°ë˜ì„¸)
                { id: 'commRateD', value: data.commRateD },
                { id: 'taxRateD', value: data.taxRateD },
                // í•´ì™¸
                { id: 'buyPriceG', value: data.buyPriceG },
                { id: 'sellPriceG', value: data.sellPriceG },
                { id: 'quantityG', value: data.quantityG },
                // í•´ì™¸ ì£¼ì‹ ì„¤ì • í•„ë“œ(ìˆ˜ìˆ˜ë£Œ, ì–‘ë„ì„¸, ê¸°ë³¸ê³µì œ, í™˜ìœ¨)
                { id: 'commRateG', value: data.commRateG },
                { id: 'taxRateG', value: data.taxRateG },
                { id: 'taxBaseG', value: data.taxBaseG },
                { id: 'exchangeRateG', value: data.exchangeRateG },
            ];

            fields.forEach(field => {
                const inputElement = document.getElementById(field.id);
                if (inputElement && field.value !== undefined) {
                    // ê°’ì— ì‰¼í‘œê°€ ìˆì—ˆë‹¤ë©´ í¬ë§·íŒ…ì„ ìœ„í•´ autoFormat í•¨ìˆ˜ë¥¼ ìˆ˜ë™ í˜¸ì¶œ (ì…ë ¥ í•„ë“œì—ë§Œ í•´ë‹¹)
                    inputElement.value = String(field.value); // ìˆœìˆ˜í•œ ê°’ ë¨¼ì € í• ë‹¹

                    // ê°€ê²©, í™˜ìœ¨, ê³µì œì™€ ê°™ì´ ì‰¼í‘œê°€ í•„ìš”í•œ í•„ë“œì—ë§Œ autoFormat ì ìš©
                    if (field.id.includes('Price') || field.id.includes('quantity') || field.id.includes('exchangeRate') || field.id.includes('taxBase')) {
                        autoFormat(inputElement);
                    }
                }
            });

            calculateProfit(targetTabId, false); // ê³„ì‚° ê²°ê³¼ í‘œì‹œ
        }

        /**
         * ê³„ì‚° ê¸°ë¡ì„ ì™„ì „íˆ ì§€ì›ë‹ˆë‹¤.
         */
        function clearHistory() {
            calculationHistory = [];
            renderHistory();
        }

        // ì†ìµ ê³„ì‚° ë©”ì¸ í•¨ìˆ˜
        function calculateProfit(type, isSaveHistory = true) {
            const resultDiv = document.getElementById('result');
            let buyPrice, sellPrice, quantity, commRate, taxRate, currencyUnit, taxName, taxBase, exchangeRate;

            // 1. ì…ë ¥ ê°’ ê°€ì ¸ì˜¤ê¸°
            if (type === 'domestic') {
                buyPrice = parseFloat(document.getElementById('buyPriceD').value.replace(/,/g, ''));
                sellPrice = parseFloat(document.getElementById('sellPriceD').value.replace(/,/g, ''));
                quantity = parseInt(document.getElementById('quantityD').value.replace(/,/g, ''));
                commRate = parseFloat(document.getElementById('commRateD').value) / 100; // % -> ì†Œìˆ˜
                taxRate = parseFloat(document.getElementById('taxRateD').value) / 100; // % -> ì†Œìˆ˜
                currencyUnit = 'ì›';
                taxName = 'ê±°ë˜ì„¸';
            } else if (type === 'global') {
                buyPrice = parseFloat(document.getElementById('buyPriceG').value.replace(/,/g, ''));
                sellPrice = parseFloat(document.getElementById('sellPriceG').value.replace(/,/g, ''));
                quantity = parseInt(document.getElementById('quantityG').value.replace(/,/g, ''));
                exchangeRate = parseFloat(document.getElementById('exchangeRateG').value.replace(/,/g, ''));
                commRate = parseFloat(document.getElementById('commRateG').value) / 100; // % -> ì†Œìˆ˜
                taxRate = parseFloat(document.getElementById('taxRateG').value) / 100; // % -> ì†Œìˆ˜ (ì–‘ë„ì†Œë“ì„¸)
                taxBase = parseInt(document.getElementById('taxBaseG').value.replace(/,/g, '')); // ê¸°ë³¸ ê³µì œ
                currencyUnit = 'ì›';
                taxName = 'ì–‘ë„ì†Œë“ì„¸';

                // ë‹¬ëŸ¬ ê¸ˆì•¡ì„ ì›í™”ë¡œ í™˜ì‚° (ê³„ì‚°ì„ ì›í™” ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰)
                if (exchangeRate) {
                    buyPrice *= exchangeRate;
                    sellPrice *= exchangeRate;
                } else {
                    alert('í™˜ìœ¨ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                    return;
                }
            }

            // 2. ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬
            if (isNaN(buyPrice) || isNaN(sellPrice) || isNaN(quantity) || quantity <= 0) {
                resultDiv.innerHTML = '<p style="color:red;">âš ï¸ ë§¤ìˆ˜/ë§¤ë„ ê°€ê²© ë° ìˆ˜ëŸ‰ì„ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>';
                return;
            }

            // 3. ê³„ì‚° ë¡œì§
            const totalBuy = buyPrice * quantity; // ì´ ë§¤ìˆ˜ ê¸ˆì•¡
            const buyComm = totalBuy * commRate; // ë§¤ìˆ˜ ìˆ˜ìˆ˜ë£Œ
            const totalSell = sellPrice * quantity; // ì´ ë§¤ë„ ê¸ˆì•¡
            const sellComm = totalSell * commRate; // ë§¤ë„ ìˆ˜ìˆ˜ë£Œ

            let profitLossBeforeTax = totalSell - totalBuy - buyComm - sellComm; // ì„¸ì „ ì†ìµ

            let tax = 0;
            let netProfitLoss = 0; // ìµœì¢… ì†ìµ
            let nTotalRate = 0; // ì´ ìˆ˜ìµë¥ 

            if (type === 'domestic') {
                // êµ­ë‚´ ì£¼ì‹: ê±°ë˜ì„¸ (ë§¤ë„ ê¸ˆì•¡ ê¸°ì¤€)
                tax = totalSell * taxRate;
                netProfitLoss = profitLossBeforeTax - tax;
            } else if (type === 'global') {
                // í•´ì™¸ ì£¼ì‹: ì–‘ë„ì†Œë“ì„¸ (ì´ìµ ë°œìƒ ì‹œ)
                const capitalGain = totalSell - totalBuy; // ì–‘ë„ì°¨ìµ (ë§¤ë§¤ ì°¨ìµ)
                
                if (capitalGain > 0) {
                    // ê¸°ë³¸ ê³µì œ ì ìš© í›„ ê³¼ì„¸ í‘œì¤€ ê³„ì‚°
                    let taxableIncome = capitalGain - taxBase;
                    if (taxableIncome < 0) taxableIncome = 0; // ê³¼ì„¸ í‘œì¤€ì€ 0ë³´ë‹¤ ì‘ì„ ìˆ˜ ì—†ìŒ

                    tax = taxableIncome * taxRate; // ì–‘ë„ì†Œë“ì„¸
                    // ì–‘ë„ì†Œë“ì„¸ëŠ” ì–‘ë„ì°¨ìµì´ ë°œìƒí–ˆì„ ë•Œë§Œ ë¶€ê³¼ë¨
                }
                netProfitLoss = profitLossBeforeTax - tax;
            }

            nTotalRate = (netProfitLoss / totalBuy * 100).toFixed(3);

            // 4. ê²°ê³¼ ì¶œë ¥
            const profitLossClass = netProfitLoss >= 0 ? 'profit' : 'loss';
            const totalTax = type === 'domestic' ? tax : tax; // êµ­ë‚´:ê±°ë˜ì„¸, í•´ì™¸:ì–‘ë„ì„¸
            
            let resultHTML = `
                <h2>ğŸ’° ê³„ì‚° ê²°ê³¼</h2>
                <p>ë§¤ìˆ˜ ì›ê¸ˆ: ${formatNumber(totalBuy)} ${currencyUnit}</p>
                <p>ë§¤ìˆ˜ ìˆ˜ìˆ˜ë£Œ (${(commRate * 100).toFixed(3)}%): ${formatNumber(buyComm)} ${currencyUnit}</p>
                <p>ì´ ë§¤ìˆ˜ ê¸ˆì•¡: ${formatNumber(totalBuy + buyComm)} ${currencyUnit}</p>
                <hr>
                <p>ë§¤ë„ ì›ê¸ˆ: ${formatNumber(totalSell)} ${currencyUnit}</p>
                <p>ë§¤ë„ ìˆ˜ìˆ˜ë£Œ (${(commRate * 100).toFixed(3)}%): ${formatNumber(sellComm)} ${currencyUnit}</p>
                <p>${taxName} (${(taxRate * 100).toFixed(2)}%): ${formatNumber(totalTax)} ${currencyUnit}</p>
                <p>ì´ ë§¤ë„ ê¸ˆì•¡: ${formatNumber(totalSell - sellComm - totalTax)} ${currencyUnit}</p>
                <hr>
                <p>ì„¸ì „ ì†ìµ: ${formatNumber(profitLossBeforeTax)} ${currencyUnit}</p>
                <p><strong>ì´ ì†ìµ: <span class="${profitLossClass}">${formatNumber(netProfitLoss)} ${currencyUnit}</span></strong></p>
                <p><strong>ì´ ìˆ˜ìµë¥ : <span class="${profitLossClass}">${nTotalRate}${'%'}</span></strong></p>
            `;
            
            if (type === 'global') {
                resultHTML += `<p style="font-size:0.9em; margin-top:10px;">(ì–‘ë„ì†Œë“ì„¸ ê¸°ë³¸ ê³µì œ ${formatNumber(taxBase)}ì›ì´ ì ìš©ëœ ê°€ê²©ì…ë‹ˆë‹¤.)</p>`;
            }

            resultDiv.innerHTML = resultHTML;

            // -------------------------------------------------------------
            // [í•µì‹¬ ì¶”ê°€] ê³„ì‚° ê¸°ë¡ ì €ì¥ ì „ì— ì…ë ¥ ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë§Œë“­ë‹ˆë‹¤.
            if (isSaveHistory) {
                const inputData = {
                    buyPriceD: parseFloat(document.getElementById('buyPriceD').value.replace(/,/g, '')),    // êµ­ë‚´ ë§¤ìˆ˜ ê°€ê²©
                    sellPriceD: parseFloat(document.getElementById('sellPriceD').value.replace(/,/g, '')),  // êµ­ë‚´ ë§¤ë„ ê°€ê²©
                    quantityD: parseInt(document.getElementById('quantityD').value.replace(/,/g, '')),    // êµ­ë‚´ ìˆ˜ëŸ‰
                    commRateD: parseFloat(document.getElementById('commRateD').value),  // êµ­ë‚´ ìˆ˜ìˆ˜ë£Œ
                    taxRateD: parseFloat(document.getElementById('taxRateD').value),    // êµ­ë‚´ ì„¸ê¸ˆ
                    
                    buyPriceG: parseFloat(document.getElementById('buyPriceG').value.replace(/,/g, '')),    // í•´ì™¸ ë§¤ìˆ˜ ê°€ê²©
                    sellPriceG: parseFloat(document.getElementById('sellPriceG').value.replace(/,/g, '')),  // í•´ì™¸ ë§¤ë„ ê°€ê²©
                    quantityG: parseInt(document.getElementById('quantityG').value.replace(/,/g, '')),    // í•´ì™¸ ìˆ˜ëŸ‰
                    commRateG: parseFloat(document.getElementById('commRateG').value),  // í•´ì™¸ ìˆ˜ìˆ˜ë£Œ
                    taxRateG: parseFloat(document.getElementById('taxRateG').value),    // í•´ì™¸ ì„¸ê¸ˆ
                    taxBaseG: parseInt(document.getElementById('taxBaseG').value.replace(/,/g, '')),
                    exchangeRateG: parseFloat(document.getElementById('exchangeRateG').value.replace(/,/g, '')), // í™˜ìœ¨
                };

                // **[í•µì‹¬ ì¶”ê°€] ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥**
                const summaryText = `ë§¤ìˆ˜: ${formatNumber(buyPrice)}${currencyUnit} | ìˆ˜ëŸ‰: ${formatNumber(quantity)}`;

                // ìµœì¢…ì ìœ¼ë¡œ ê²°ê³¼ ì°½ì— HTMLì„ ì¶œë ¥í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.
                resultDiv.innerHTML = resultHTML; // (ê¸°ì¡´ ì½”ë“œ)

                // ê³„ì‚° ê¸°ë¡ ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ (ìµœì¢… ê²°ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì¸ìë¡œ ë„˜ê¹€)
                saveHistory(type, inputData, summaryText);
            }
            // -------------------------------------------------------------
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ êµ­ë‚´ ì£¼ì‹ íƒ­ì´ ë³´ì´ë„ë¡ ì„¤ì •
        document.addEventListener('DOMContentLoaded', () => {
            openTab('domestic');
        });
    </script>
</body>
</html>